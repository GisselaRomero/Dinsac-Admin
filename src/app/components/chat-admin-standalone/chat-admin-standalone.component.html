<div class="admin-chat-container">
  
  <!-- SIDEBAR: Lista de clientes -->
  <div class="sidebar">
    <div class="sidebar-header">
      <h3>ğŸ’¬ Conversaciones</h3>
    </div>

    <div class="clientes-lista">
      <div 
        *ngFor="let cliente of clientes" 
        class="cliente-item"
        [class.activo]="cliente.id === clienteSeleccionado"
        (click)="seleccionarCliente(cliente.id)"
      >
        <div class="cliente-info">
          <div class="cliente-avatar">ğŸ‘¤</div>
          <div class="cliente-detalles">
            <p class="cliente-nombre">{{ cliente.nombre }}</p>
            <p class="ultimo-mensaje" *ngIf="cliente.ultimoMensaje">
              {{ cliente.ultimoMensaje.length > 30 ? (cliente.ultimoMensaje | slice:0:30) + '...' : cliente.ultimoMensaje }}
            </p>
          </div>
        </div>
        <span class="notificacion" *ngIf="cliente.notificaciones && cliente.notificaciones > 0">
          {{ cliente.notificaciones }}
        </span>
      </div>

      <div *ngIf="clientes.length === 0" class="sin-clientes">
        <p>No hay conversaciones activas</p>
      </div>
    </div>
  </div>

  <!-- CHAT AREA -->
  <div class="chat-area">
    
    <!-- Header del chat -->
    <div class="chat-header" *ngIf="clienteSeleccionado">
      <div class="header-info">
        <h3>{{ getClienteNombre() }}</h3>
      </div>
      <button class="btn-eliminar" (click)="eliminarChat()" title="Eliminar conversaciÃ³n">
        ğŸ—‘ï¸ Eliminar Chat
      </button>
    </div>

    <!-- Placeholder cuando no hay cliente seleccionado -->
    <div class="no-seleccionado" *ngIf="!clienteSeleccionado">
      <div class="placeholder-content">
        <div class="placeholder-icon">ğŸ’¬</div>
        <h3>Selecciona una conversaciÃ³n</h3>
        <p>Elige un cliente de la lista para ver sus mensajes</p>
      </div>
    </div>

    <!-- Mensajes -->
    <div class="mensajes" *ngIf="clienteSeleccionado">
      <div *ngFor="let msg of mensajes" 
           [class]="'mensaje ' + (msg.remitente === 'admin' ? 'mensaje-admin' : 'mensaje-cliente')">
        
        <div class="mensaje-contenido">
          <p class="mensaje-nombre" *ngIf="msg.remitente === 'cliente'">
            {{ msg.nombre || 'Cliente' }}
          </p>

          <!-- ğŸ“„ Si es un archivo -->
          <div *ngIf="esArchivo(msg.mensaje)" class="archivo-mensaje">
            
            <!-- ğŸ–¼ï¸ Si es imagen -->
            <div *ngIf="esImagen(msg.mensaje)" class="imagen-preview">
              <img [src]="msg.mensaje" [alt]="obtenerNombreArchivo(msg.mensaje)" />
              <a [href]="msg.mensaje" target="_blank" class="ver-completo">
                Ver imagen completa
              </a>
            </div>

            <!-- ğŸ“„ Si es PDF -->
            <div *ngIf="esPDF(msg.mensaje)" class="pdf-preview">
              <div class="pdf-icon">ğŸ“„</div>
              <div class="pdf-info">
                <p class="pdf-nombre">{{ obtenerNombreArchivo(msg.mensaje) }}</p>
                <a [href]="msg.mensaje" target="_blank" class="btn-abrir-pdf">
                  Abrir PDF
                </a>
              </div>
            </div>
          </div>

          <!-- ğŸ’¬ Si es texto normal -->
          <p *ngIf="!esArchivo(msg.mensaje)" class="mensaje-texto">{{ msg.mensaje }}</p>
          
          <span class="mensaje-hora">{{ obtenerHora(msg.fecha) }}</span>
        </div>
      </div>
    </div>

    <!-- Input de chat -->
    <div class="chat-input" *ngIf="clienteSeleccionado">
      <input 
        type="file" 
        id="fileInput" 
        style="display: none" 
        accept="image/*,.pdf"
        (change)="enviarArchivo($event)"
      />
      
      <button class="btn-adjuntar" (click)="abrirSelector()" title="Adjuntar archivo">
        ğŸ“
      </button>

      <input 
        type="text" 
        [(ngModel)]="mensajeEscrito" 
        (keyup.enter)="enviarMensaje()"
        placeholder="Escribe tu respuesta..."
        class="input-mensaje"
      />
      
      <button (click)="enviarMensaje()" class="btn-enviar">
        Enviar
      </button>
    </div>

  </div>

</div>